@import "tailwindcss";

/* =========================
   THEME & TOKENS
   ========================= */
:root{
  color-scheme: dark;
  --bg: #0f172a;
  --fg: #e2e8f0;
  --muted: #334155;

  /* Kích thước ô */
  --cell: clamp(1.55rem, 2.2vw, 1.95rem);
  --cell-br: .125rem;

  /* Lưới: Fallback trước, srgb nếu trình duyệt hỗ trợ color-mix */
  --grid-line: rgba(148,163,184,.35); /* Fallback an toàn */
  --grid-off: 1px; /* nếu răng cưa, thử 0.5px/0px */
}
@supports (background: color-mix(in srgb, #000 50%, transparent)) {
  :root { --grid-line: color-mix(in srgb, var(--muted) 55%, transparent); }
}

html, body { height: 100%; }
body{
  background: var(--bg);
  color: var(--fg);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* =========================
   GRID (Ô sát nhau + lưới chuẩn zoom)
   ========================= */
.board-tight{
  position: relative;
  display: grid;
  grid-template-columns: repeat(12, var(--cell));
  grid-auto-rows: var(--cell);
  gap: 0;
  background:
    repeating-linear-gradient(0deg,  var(--grid-line) 0 1px, transparent 1px var(--cell)),
    repeating-linear-gradient(90deg, var(--grid-line) 0 1px, transparent 1px var(--cell));
  background-size: var(--cell) var(--cell), var(--cell) var(--cell);
  background-position: var(--grid-off) var(--grid-off), var(--grid-off) var(--grid-off);
  will-change: background-position;
}
.board-tight::after{
  content:"";
  position:absolute; inset: var(--grid-off);
  border:1px solid var(--grid-line);
  pointer-events:none;
}

/* Ô lưới */
.cell{
  width: var(--cell);
  height: var(--cell);
  display: grid;
  place-items: center;
  border: 0;
  border-radius: 0;
  position: relative;
  transition: box-shadow .14s ease, transform .06s ease, background-color .12s ease;
  will-change: box-shadow, transform, background-color;
  contain: paint;
}
/* Hover: thêm fallback trước, color-mix sau (override khi hỗ trợ) */
.cell:hover{
  box-shadow: inset 0 0 0 1px rgba(56,189,248,.65);
  box-shadow: inset 0 0 0 1px color-mix(in srgb, #38bdf8 65%, transparent);
}
.cell.obstacle{ background: rgba(30,41,59,.9); }
.cell.unit{
  background: rgba(5,150,105,.85);
  outline: 1px dashed rgba(16,185,129,.5);
  outline-offset: -2px;
}
.cell.hit{
  background: rgba(220,38,38,.78);
  animation: hit-flash .5s ease both;
}

/* Preview vùng bắn / đặt quân */
.cell[data-pv],
.cell--pv-ok,
.cell--pv-bad,
.cell--aim{ transform: translateZ(0) scale(1.02); }
.cell[data-pv]::after,
.cell--pv-ok::after,
.cell--pv-bad::after,
.cell--aim::after{
  content:""; position:absolute; inset:0; border-radius:0; pointer-events:none;
}
.cell[data-pv="ok"]::after,
.cell--pv-ok::after,
.cell--aim::after{
  background: rgba(251,191,36,.16);
  box-shadow: inset 0 0 0 2px rgba(251,191,36,.95);
}
.cell[data-pv="bad"]::after,
.cell--pv-bad::after{
  background: rgba(244,63,94,.16);
  box-shadow: inset 0 0 0 2px rgba(244,63,94,.95);
}

/* Pop khi trúng */
@keyframes hit-flash{
  0%   { filter: brightness(1.25); transform: scale(1.03); }
  60%  { filter: brightness(1.05); transform: scale(1); }
  100% { filter: brightness(1); }
}

/* Con trỏ bắn */
.cell[data-can-fire="true"]:hover { cursor: crosshair; }

/* =========================
   CARDS / PANELS / BADGES / BUTTONS
   ========================= */
.glass{
  background: color-mix(in srgb, #0b1220 70%, transparent);
  backdrop-filter: blur(6px);
  border: 1px solid rgba(148,163,184,.15);
}
.board-card{
  background: color-mix(in srgb, #0b1220 70%, transparent);
  backdrop-filter: blur(6px);
  border: 1px solid rgba(148,163,184,.16);
  border-radius: 1rem;
  padding: 1rem;
  box-shadow: 0 10px 24px -12px rgba(2,6,23,.45);
}
.button{
  display:inline-flex; align-items:center; gap:.5rem;
  padding:.5rem .75rem; border-radius:.75rem;
  background:#0b1220;
  border:1px solid rgba(148,163,184,.18);
  transition: transform .06s ease, background .15s ease, border-color .15s ease, opacity .15s ease;
  cursor: pointer; user-select: none;
}
.button:hover{ background:#111a2d; border-color:rgba(148,163,184,.28); }
.button:active{ transform: translateY(1px); }
.button[disabled]{ opacity:.5; cursor:not-allowed; }

.badge{
  display:inline-flex; align-items:center; gap:.4rem;
  height: 1.6rem; padding: 0 .6rem;
  border-radius: .6rem;
  background: rgba(30,41,59,.65);
  border: 1px solid rgba(148,163,184,.18);
  font-size:.75rem; line-height:1;
}
.badge--ok   { background: rgba(16,185,129,.15); border-color: rgba(16,185,129,.35); }
.badge--warn { background: rgba(250,204,21,.15); border-color: rgba(250,204,21,.35); }
.badge--info { background: rgba(56,189,248,.12); border-color: rgba(56,189,248,.35); }

.timer-pill{
  display:inline-flex; align-items:center; gap:.4rem;
  padding:.25rem .5rem; border-radius:.5rem;
  background: rgba(51,65,85,.55);
  border: 1px solid rgba(148,163,184,.18);
  font-variant-numeric: tabular-nums;
}

.kbd{
  display:inline-flex; align-items:center; justify-content:center;
  min-width: 1.2rem; height: 1.4rem; padding: 0 .35rem;
  border-radius: .35rem; background: rgba(15,23,42,.9);
  border:1px solid rgba(148,163,184,.25);
  font-size: .75rem; line-height: 1;
  box-shadow: inset 0 -2px 0 rgba(0,0,0,.25);
}

/* =========================
   LEGEND BAR
   ========================= */
.legend-bar{ display:flex; flex-wrap:wrap; gap:.5rem .75rem; align-items:center; }
.legend-item{
  display:inline-flex; align-items:center; gap:.5rem;
  padding:.35rem .55rem; border-radius:.6rem;
  background: rgba(30,41,59,.55); border: 1px solid rgba(148,163,184,.16);
  font-size:.8rem;
}
.legend-swatch{
  width:.9rem; height:.9rem; border-radius:.25rem;
  box-shadow: 0 0 0 1px rgba(148,163,184,.25) inset;
}
.legend-swatch--unit   { background: rgba(16,185,129,.75); }
.legend-swatch--hit    { background: rgba(220,38,38,.75); }
.legend-swatch--target { outline: 2px solid rgba(251,191,36,.75); }
.legend-swatch--rock   { background: rgba(30,41,59,.95); }

/* =========================
   AXES LABELS (khớp lưới)
   ========================= */
.grid-axes{ font-size:.75rem; opacity:.7; user-select:none; font-variant-numeric: tabular-nums; }
.axes-cols{ transform: translateX(var(--grid-off)); }
.axes-rows{ transform: translateY(var(--grid-off)); }

/* =========================
   SCROLLBAR (WebKit)
   ========================= */
*::-webkit-scrollbar{ height:10px; width:10px; }
*::-webkit-scrollbar-track{ background: rgba(15,23,42,.3); }
*::-webkit-scrollbar-thumb{
  background: rgba(100,116,139,.45);
  border-radius: 8px; border: 2px solid rgba(15,23,42,.4);
}
*::-webkit-scrollbar-thumb:hover{ background: rgba(148,163,184,.6); }

/* =========================
   SMALL UTILITIES
   ========================= */
.card { border-radius: 1rem; }
.animate-ping-slow { animation: ping .8s ease-out; }
@keyframes ping { 75%,100% { transform: scale(1.15); opacity:.35 } }

@media (max-width: 420px){
  :root{ --cell: clamp(1.6rem, 4.5vw, 2.05rem); }
}

/* ============ HIT FX (ô trúng/miss/radar) ============ */
@layer utilities {
  @keyframes hit-pop { 0% { transform: scale(0.85); filter: brightness(1.8); } 100% { transform: scale(1); filter: brightness(1); } }
  @keyframes hit-ring { 0% { transform: scale(0.2); opacity: .95; } 100% { transform: scale(1.8); opacity: 0; } }
  @keyframes cell-shake { 0%,100% { transform: translateX(0); } 20% { transform: translateX(-1.5px); } 40% { transform: translateX(1.5px); } 60% { transform: translateX(-1px); } 80% { transform: translateX(1px); } }
  @keyframes hit-smoke { 0% { opacity: .7; filter: blur(0px); transform: translateY(0) scale(0.9); } 100% { opacity: 0; filter: blur(3px); transform: translateY(-8px) scale(1.15); } }

  .hit-flash {
    animation: hit-pop 160ms ease-out;
    box-shadow: inset 0 0 0 2px rgba(255,255,255,.9), 0 0 10px rgba(255,210,80,.9);
    background-image: radial-gradient(transparent 55%, rgba(255,220,120,.25) 80%);
  }
  .ring-base {
    position: absolute; left: 50%; top: 50%;
    width: 8px; height: 8px; border-width: 2px; border-style: solid; border-radius: 9999px;
    transform: translate(-50%, -50%);
    animation: hit-ring 450ms ease-out forwards; pointer-events: none;
  }
  .ring-hit  { border-color: rgba(255, 180, 0, 0.95); } /* mặc định amber */
  .ring-miss { border-color: rgba(220, 230, 255, 0.85); }

  .hit-smoke {
    position: absolute; inset: 0; pointer-events: none;
    background: radial-gradient(ellipse at 50% 55%, rgba(60,60,60,.35) 0%, rgba(0,0,0,0) 60%);
    mix-blend-mode: multiply; animation: hit-smoke 650ms ease-out forwards;
  }
  .scorch {
    position: absolute; inset: 0; pointer-events: none;
    background: radial-gradient(circle, rgba(0,0,0,.35) 0%, rgba(0,0,0,.15) 40%, rgba(0,0,0,0) 70%);
    mix-blend-mode: multiply;
  }
  .shake-xs { animation: cell-shake 240ms ease-in-out; }

  @media (prefers-reduced-motion: reduce) {
    .hit-flash, .ring-base, .hit-smoke, .shake-xs { animation: none !important; }
  }
}

/* ============ PHÂN BIỆT BẢNG MÌNH / ĐỐI THỦ ============ */
/* Gắn class lên container: .board--me (bảng của tôi), .board--enemy (bảng đối thủ) */
.board--me    { --hit-ring: rgba(239,68,68,.95);  --hit-flash: rgba(255,130,130,.35); } /* đỏ khi mình bị trúng */
.board--enemy { --hit-ring: rgba(251,191,36,.95); --hit-flash: rgba(255,220,120,.25); } /* amber khi mình bắn trúng */

.board--me .ring-hit,
.board--enemy .ring-hit { border-color: var(--hit-ring) !important; }
.board--me .hit-flash,
.board--enemy .hit-flash { background-image: radial-gradient(transparent 55%, var(--hit-flash) 80%); }

/* Rung cả bảng khi mình bị trúng: thêm .got-hit vào container */
@keyframes board-damage {
  0% { transform: translateX(0);   box-shadow: 0 0 0 0 rgba(239,68,68,.55); }
  25%{ transform: translateX(-2px); box-shadow: 0 0 0 6px rgba(239,68,68,.25); }
  50%{ transform: translateX(2px);  box-shadow: 0 0 0 10px rgba(239,68,68,.12); }
  100%{ transform: translateX(0);   box-shadow: 0 0 0 0 rgba(239,68,68,0); }
}
.board--me.got-hit,
.board--me .board-tight.got-hit,
.board--me .board-card.got-hit { animation: board-damage 320ms ease-out; }
@media (prefers-reduced-motion: reduce) {
  .board--me.got-hit,
  .board--me .board-tight.got-hit,
  .board--me .board-card.got-hit { animation: none !important; }
}

/* =========================================================
   Ô ĐỊCH CÓ QUÂN BỊ BẮN TRÚNG  (override .cell.hit)
   - BoardGrid sẽ gắn class "hit-unit" cho những ô địch vừa bị trúng
   - Đặt sau .cell.hit để chắc chắn override
   ========================================================= */
.cell.hit.hit-unit{
  background: rgba(245, 158, 11, 0.92) !important; /* amber đậm */
  box-shadow: inset 0 0 0 1px rgba(251, 191, 36, .75),
              0 0 0 2px rgba(251, 191, 36, .08);
}
/* Nếu muốn chỉ áp dụng riêng cho bảng địch */
.board--enemy .cell.hit.hit-unit{
  background: rgba(245, 158, 11, 0.92) !important;
}
